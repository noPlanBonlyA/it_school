# –£–ª—É—á—à–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞ –∏—Å—Ç–æ—Ä–∏–∏ –º–æ–Ω–µ—Ç (coinHistoryService.js)

## üìã –ü—Ä–æ–≤–µ–¥—ë–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑

–ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–¥–∞ `coinHistoryService.js`, –±—ã–ª–∏ –≤–Ω–µ—Å–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è:

## ‚úÖ –í–Ω–µ—Å—ë–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. **–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–∞**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è `limit` (1-100) –∏ `offset` (‚â•0) —Å–æ–≥–ª–∞—Å–Ω–æ API —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫ –≤–∞–ª–∏–¥–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º

### 2. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è JSDoc**
- –î–æ–±–∞–≤–ª–µ–Ω—ã –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- –£–∫–∞–∑–∞–Ω—ã —Ç–∏–ø—ã UUID –¥–ª—è ID –ø–æ–ª–µ–π
- –û–ø–∏—Å–∞–Ω—ã –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è enum'–æ–≤

### 3. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–ø–∏—Å–µ–π**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π (`user_id`, `reason`, `changed_points`)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è `reason` –ø—Ä–æ—Ç–∏–≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã `POINT_REASONS`
- –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

### 4. **–ù–æ–≤—ã–µ —É—Ç–∏–ª–∏—Ç–∞—Ä–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**

#### `getOperationColor(changedPoints)`
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç CSS –∫–ª–∞—Å—Å –¥–ª—è —Ü–≤–µ—Ç–æ–≤–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π:
- `'success'` - –¥–ª—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π (+)
- `'danger'` - –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏–π (-)
- `'secondary'` - –¥–ª—è –Ω—É–ª–µ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

#### `formatPointsChange(changedPoints)`
–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–∏–Ω—Ç–æ–≤:
- –î–æ–±–∞–≤–ª—è–µ—Ç `+` –¥–ª—è –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á–∏—Å–ª–æ –∫–∞–∫ –µ—Å—Ç—å –¥–ª—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö

## üîß –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ API

–°–µ—Ä–≤–∏—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç API —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏:

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:
- ‚úÖ `GET /api/points/history/user` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∏–Ω—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ `POST /api/points/history/` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –∏—Å—Ç–æ—Ä–∏–∏
- ‚úÖ `POST /api/notifications/` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã –ø—Ä–∏—á–∏–Ω (Reason):
- `Homework` - –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ
- `Visit` - –ü–æ—Å–µ—â–µ–Ω–∏–µ —É—Ä–æ–∫–∞  
- `Bonus` - –ë–æ–Ω—É—Å
- `Penalty` - –®—Ç—Ä–∞—Ñ
- `Buy` - –ü–æ–∫—É–ø–∫–∞
- `Other` - –î—Ä—É–≥–æ–µ

## üìä –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö

### PointsHistoryCreateSchema:
```typescript
{
  user_id: string (UUID)
  reason: "Homework" | "Visit" | "Bonus" | "Penalty" | "Buy" | "Other"
  changed_points: number
  description: string
  id?: string (UUID, optional)
}
```

### PointsHistoryReadSchema:
```typescript
{
  user_id: string (UUID)
  reason: string
  changed_points: number
  description: string
  created_at: string (datetime)
  updated_at: string (datetime)
  id: string (UUID)
}
```

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

1. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –í—Å–µ–≥–¥–∞ –æ–±–æ—Ä–∞—á–∏–≤–∞–π—Ç–µ –≤—ã–∑–æ–≤—ã –≤ try-catch
2. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `createPointsHistoryWithNotification` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
3. **–£—Ä–æ–∫**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `createLessonCoinsHistory` –¥–ª—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –º–æ–Ω–µ—Ç –∑–∞ —É—Ä–æ–∫–∏
4. **UI**: –ü—Ä–∏–º–µ–Ω—è–π—Ç–µ `getOperationColor` –∏ `formatPointsChange` –¥–ª—è –ª—É—á—à–µ–≥–æ UX

## ‚úÖ –°—Ç–∞—Ç—É—Å

–°–µ—Ä–≤–∏—Å –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç API —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
